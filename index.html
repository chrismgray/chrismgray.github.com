<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Hiking and Coding</title>

<link rel="stylesheet" href="style.css" type="text/css" />

<link rel="stylesheet" href="local.css" type="text/css" />


<link rel="alternate" type="application/rss+xml" title="Hiking and Coding (RSS feed)" href="index.rss" /><link rel="alternate" type="application/atom+xml" title="Hiking and Coding (Atom feed)" href="index.atom" />


<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

</span>
<span class="title">
Hiking and Coding

</span>
</span>

</div>


<div class="actions">
<ul>


<li><a href="./recentchanges/">RecentChanges</a></li>






<li>

<a href="">Comment</a>

</li>

</ul>
</div>




</div>


<div class="sidebar">
<div><div class="calendar"><table class="month-calendar">
    <tr>
    <th class="month-calendar-arrow"><a href="./archives/2011/10/" title="October">&larr;</a></th>
    <th class="month-calendar-head" colspan="5"><a href="./archives/2011/11/" title="November">Nov 2011</a></th>
    <th class="month-calendar-arrow"><a href="./archives/2011/12/" title="December">&rarr;</a></th>
    </tr>
    <tr>
        <th class="month-calendar-day-head Sunday" title="Sunday">S</th>
        <th class="month-calendar-day-head Monday" title="Monday">M</th>
        <th class="month-calendar-day-head Tuesday" title="Tuesday">T</th>
        <th class="month-calendar-day-head Wednesday" title="Wednesday">W</th>
        <th class="month-calendar-day-head Thursday" title="Thursday">T</th>
        <th class="month-calendar-day-head Friday" title="Friday">F</th>
        <th class="month-calendar-day-head Saturday" title="Saturday">S</th>
    </tr>
    <tr>
        <td class="month-calendar-day-noday Sunday">&nbsp;</td>
        <td class="month-calendar-day-noday Monday">&nbsp;</td>
        <td class="month-calendar-day-nolink Tuesday">1</td>
        <td class="month-calendar-day-nolink Wednesday">2</td>
        <td class="month-calendar-day-nolink Thursday">3</td>
        <td class="month-calendar-day-nolink Friday">4</td>
        <td class="month-calendar-day-nolink Saturday">5</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">6</td>
        <td class="month-calendar-day-nolink Monday">7</td>
        <td class="month-calendar-day-nolink Tuesday">8</td>
        <td class="month-calendar-day-link Wednesday"><a href="./posts/rationals-in-cljs/" title="rationals-in-cljs">9</a></td>
        <td class="month-calendar-day-link Thursday"><a href="./posts/blogging-about-blogging/" title="blogging-about-blogging">10</a></td>
        <td class="month-calendar-day-link Friday"><a href="./posts/cljs-name-resolving-2/" title="cljs-name-resolving-2">11</a></td>
        <td class="month-calendar-day-this-day Saturday"><a href="./posts/time-series-1/" title="time-series-1">12</a></td>
    </tr>
    <tr>
        <td class="month-calendar-day-future Sunday">13</td>
        <td class="month-calendar-day-nolink Monday">14</td>
        <td class="month-calendar-day-nolink Tuesday">15</td>
        <td class="month-calendar-day-nolink Wednesday">16</td>
        <td class="month-calendar-day-nolink Thursday">17</td>
        <td class="month-calendar-day-nolink Friday">18</td>
        <td class="month-calendar-day-nolink Saturday">19</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">20</td>
        <td class="month-calendar-day-nolink Monday">21</td>
        <td class="month-calendar-day-nolink Tuesday">22</td>
        <td class="month-calendar-day-nolink Wednesday">23</td>
        <td class="month-calendar-day-nolink Thursday">24</td>
        <td class="month-calendar-day-nolink Friday">25</td>
        <td class="month-calendar-day-nolink Saturday">26</td>
    </tr>
    <tr>
        <td class="month-calendar-day-nolink Sunday">27</td>
        <td class="month-calendar-day-nolink Monday">28</td>
        <td class="month-calendar-day-nolink Tuesday">29</td>
        <td class="month-calendar-day-nolink Wednesday">30</td>
        <td class="month-calendar-day-noday Thursday">&nbsp;</td>
        <td class="month-calendar-day-noday Friday">&nbsp;</td>
        <td class="month-calendar-day-noday Saturday">&nbsp;</td>
    </tr>
</table>
</div></div>

<p><a href="./archives/">Archives</a></p>

<p><a href="./tags/">Tags</a>:</p>

<ul class="list">
<li><span class="smallestPC"><a href="./tags/blogging/">blogging</a></span>
</li><li><span class="biggestPC"><a href="./tags/clojure/">clojure</a></span>
</li><li><span class="bigPC"><a href="./tags/clojurescript/">clojurescript</a></span>
</li><li><span class="smallestPC"><a href="./tags/emacs/">emacs</a></span>
</li><li><span class="smallestPC"><a href="./tags/git/">git</a></span>
</li><li><span class="smallestPC"><a href="./tags/hiking/">hiking</a></span>
</li><li><span class="smallestPC"><a href="./tags/ikiwiki/">ikiwiki</a></span>
</li><li><span class="bigPC"><a href="./tags/lab-notes/">lab-notes</a></span>
</li><li><span class="smallestPC"><a href="./tags/org-mode/">org-mode</a></span>
</li><li><span class="bigPC"><a href="./tags/rationals/">rationals</a></span>
</li><li><span class="smallestPC"><a href="./tags/time-series/">time-series</a></span>
</li><li><span class="smallestPC"><a href="./tags/voronoi-diagram/">voronoi-diagram</a></span>
</li></ul>

<p>Post interval:
<img src="./sidebar/sparkline-c00e544ca987e9b0a2106307543cc123987e6fb8.png" alt="graph" /></p>

<p><a href="http://twitter.com/frogmanjack">Twitter</a>: last checked <span class="date">Sat Nov 12 22:00:04 2011</span> (23 posts)</p>

<div class="microblog">

<div class="inlinecontent">
frogmanjack: Van Morrison's Astral Weeks is such a great album.











</div>

<div class="microblog-header">


<span class="author">

<a href="http://twitter.com/frogmanjack">Twitter</a>

</span>


&mdash; <span class="date">Fri Nov 11 18:39:20 2011</span>

</div> <!--.microblog-header-->
</div> <!--.microblog-->
<div class="microblog">

<div class="inlinecontent">
frogmanjack: The problem with Canadian Thanksgiving is that there's nothing to provide a barrier between Halloween and Christmas.











</div>

<div class="microblog-header">


<span class="author">

<a href="http://twitter.com/frogmanjack">Twitter</a>

</span>


&mdash; <span class="date">Thu Nov 10 21:40:56 2011</span>

</div> <!--.microblog-header-->
</div> <!--.microblog-->
<div class="microblog">

<div class="inlinecontent">
frogmanjack: RT @grahamclark: Hey everyone, I'm already tired of Christmas!











</div>

<div class="microblog-header">


<span class="author">

<a href="http://twitter.com/frogmanjack">Twitter</a>

</span>


&mdash; <span class="date">Thu Nov 10 21:29:59 2011</span>

</div> <!--.microblog-header-->
</div> <!--.microblog-->
<div class="microblog">

<div class="inlinecontent">
frogmanjack: RT @ginatrapani: Great work comes from sustained effort over time, people. There are no shortcuts.











</div>

<div class="microblog-header">


<span class="author">

<a href="http://twitter.com/frogmanjack">Twitter</a>

</span>


&mdash; <span class="date">Thu Nov 10 12:26:55 2011</span>

</div> <!--.microblog-header-->
</div> <!--.microblog-->
<div class="microblog">

<div class="inlinecontent">
frogmanjack: @jaspervl Sharp knives are safer!











</div>

<div class="microblog-header">


<span class="author">

<a href="http://twitter.com/frogmanjack">Twitter</a>

</span>


&mdash; <span class="date">Thu Nov 10 11:32:08 2011</span>

</div> <!--.microblog-header-->
</div> <!--.microblog-->


</div>


<div id="pagebody">

<div id="content">
<div  class="feedlink">

<a class="feedbutton" type="application/rss+xml" rel="alternate" title="Hiking and Coding (RSS feed)" href="index.rss">RSS</a>


<a class="feedbutton" type="application/atom+xml" rel="alternate" title="Hiking and Coding (Atom feed)" href="index.atom">Atom</a>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/time-series-1/">time-series-1</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Programming challenges </h2>
<div class="outline-text-2" id="text-1">


<p>
  One of the interesting aspects of looking for a job this time around
  is that most of the companies that I have applied at have asked me
  to do a programming challenge as a kind of weed-out step.  It has
  been fun and a good way of keeping in practice.  In fact, I have
  resolved to learn at least one new feature of the programming
  language that I am using for each one.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Time series framework </h2>
<div class="outline-text-2" id="text-2">


<p>
  My latest programming challenge is to build a framework for <a href="http://en.wikipedia.org/wiki/Time_series">time series</a> generation.  The framework will take a function \(f\) that
  looks at the \(n\) previous timesteps and returns the next timestep.
  The other goals are:
</p><ul>
<li>Efficiency

<p>    
    Adding a new timestep should be a \(O(1)\) operation.
</p></li>
<li>Ease of debugging

<p>    
    If an error occurs in computing the next timestep, the stack trace
    should be easily comprehensible and show the current state of the
    time series.
</p></li>
<li>Traceability

<p>    
    It should be possible to see the differences between two different
    functions.  
</p></li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Ideas so far </h2>
<div class="outline-text-2" id="text-3">


<p>
  This seems like the perfect time to learn about <a href="http://onclojure.com/2009/03/05/a-monad-tutorial-for-clojure-programmers-part-1/">monads</a>.  Yikes!
  I've tried before, but have never seen a practical use for them.  As
  far as I understand so far, they should be very good for storing the
  state (<i>i.e.</i> the previous \(n\) timesteps).
</p>
<p>
  A simpler solution might be just to use lazy sequences.  There's not
  much to such a solution, so I might just implement it first and then
  try to replicate it with monads.  In this solution, the previous \(n\)
  timesteps are simply the last \(n\) elements of the lazy sequence.
  Getting those elements might be tough to do in constant time, but I
  have a feeling it's possible.
</p>
<p>
  On the debugging front, there shouldn't be too much complexity: it
  should just be a combination of <code>try</code>, <code>catch</code>, and <code>throw</code>.
  There's also <code>clojure.stacktrace</code> if I want to get even fancier.
</p>
<p>
  As far as tracing goes, I might have a look at <code>tools.trace</code> to see
  if there's anything interesting there that I can use.  I think that
  monads might provide another way of doing the same thing.  We'll see
  which is simpler.  It might also be nice to use <a href="http://incanter.org">incanter</a> to display
  the differences between two (or more) different functions.
</p>
<p>
  On to the coding!
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sat Nov 12 09:27:15 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/time-series/" rel="tag">time-series</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/cljs-name-resolving-2/">cljs-name-resolving-2</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Done! </h2>
<div class="outline-text-2" id="text-1">


<p>
  I was close with my guess in the last post.  What ended up working
  was
</p>



<pre class="src src-clojure">(let [name (munge (symbol (str (-&gt; env :ns :name) <span>"."</span> (munge (str sym)))))
</pre>




<p>
  For some reason, <code>(name sym)</code> would crash the compiler from the
  <code>parse</code> method but it wouldn't from other functions caled from the
  <code>parse</code> method.  I finally gave up worrying about that and just used
  <code>(str sym)</code> instead, since that is guaranteed to be the same in this
  case &ndash; there is an <code>(assert (not (namespace sym)))</code> just before the
  <code>let</code> line.  I gave up on worrying about it, but someone who knows
  more about the compiler than me might want to try to figure out why
  it is.
</p>
<p>
  I also needed to allow names defined in <code>cljs.core</code> but redefined in
  another namespace to be called or referred to.  This involved
  changing the <code>resolve-existing-var</code> function.  Again, <code>cljs.core</code> is
  hardcoded:
</p>



<pre class="src src-clojure">(let [full-ns (if (and (core-name? env sym) (nil? (get-in @namespaces [(-&gt; env :ns :name) :defs sym])))
                'cljs.core
                (-&gt; env :ns :name))]
</pre>




<p>
  I added the second test: it simply asks whether the variable has
  been defined in the namespace.  If it hasn't, and the variable is
  defined in <code>cljs.core</code>, only then is the namespace set to
  <code>cljs.core</code>.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Remove the macros </h2>
<div class="outline-text-2" id="text-2">


<p>
  It was also necessary to remove many of the macros from <code>core.clj</code>
  in order to redefine the functions that I needed to in my project.
  As I noted earlier, my project is to implement rationals in
  Clojurescript, so I need to redefine most of the functions that work
  with numbers.  (At least, that is the way I am implementing it --
  there may be a better way that I don't know about.)  Many of these
  functions were implemented twice: once as a macro in <code>core.clj</code> and
  once as a function in <code>core.cljs</code>.  I am obviously biased towards
  being able to redefine these functions, so I think the macros should
  be removed, but at least one of the implementations is redundant.
</p>



</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Fri Nov 11 18:07:52 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/clojurescript/" rel="tag">clojurescript</a>

<a href="./tags/lab-notes/" rel="tag">lab-notes</a>

<a href="./tags/rationals/" rel="tag">rationals</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/cljs-name-resolving/">cljs-name-resolving</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Resolving names as they are compiled in Clojurescript </h2>
<div class="outline-text-2" id="text-1">


<p>
  I think I found the bug in the Clojurescript compiler that I was
  <a href="http://chrismgray.github.com/more-rationals">looking for yesterday</a>.  Just to refresh the memory, when defining a
  function that has a function of the same name in <code>cljs.core</code>, the
  compiler will assume that you are trying to redefine the function
  from <code>cljs.core</code>, rather than the function in the namespace that you
  are actually in.  Since I am trying to redefine functions like <code>/</code>
  and <code>*</code>, this is a problem.
</p>
<p>
  Let's look at the evidence.  First, there's this:
</p>



<pre class="src src-clojure">(defmethod parse 'def
  [op env form name]
  (let [pfn (fn ([_ sym] {:sym sym})
              ([_ sym init] {:sym sym :init init})
              ([_ sym doc init] {:sym sym :doc doc :init init}))
        args (apply pfn form)
        sym (:sym args)]
    (assert (not (namespace sym)) <span>"Can't def ns-qualified name"</span>)
    (let [name (munge (:name (resolve-var (dissoc env :locals) sym)))
</pre>




<p>
  The important line there is the last: when defining a new name,
  <code>resolve-var</code> is called on the symbol.  Let's have a look at that
  function.  There is a <code>cond</code>, and when none of the tests return
  true, the following is done:
</p>



<pre class="src src-clojure">(munge (symbol (str
                (if (core-name? env sym)
                  'cljs.core
                  (-&gt; env :ns :name))
                <span>"."</span> (munge (name sym))))))]
</pre>




<p>
  This is seeing if the symbol name is in <code>cljs.core</code>, and if it is
  setting the namespace of the symbol to <code>cljs.core</code>.  Normally that
  would be correct &ndash; one doesn't want to need to <code>use</code> <code>cljs.core</code> in
  every file &ndash; but it doesn't allow for redefinition of functions
  that are in <code>cljs.core</code> (at least without completely shadowing
  them).
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">What to do </h2>
<div class="outline-text-2" id="text-2">


<p>
  So what can we do about this?  The first thing that seems odd to me
  is that the symbol being defined is being resolved first.  Every
  symbol that is defined is defined within its own namespace, so there
  should be no need to resolve it.  That suggests that we should be
  able to take the part of <code>resolve-var</code> that doesn't have a special
  case for <code>cljs.core</code> and put it into the <code>parse</code> method.  Something
  like
</p>



<pre class="src src-clojure">(let [name (munge (:name (symbol (str (-&gt; env :ns :name) <span>"."</span> (munge (name sym))))))])
</pre>




<p>
  might work in the <code>parse</code> method.
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Fri Nov 11 07:23:38 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/clojurescript/" rel="tag">clojurescript</a>

<a href="./tags/lab-notes/" rel="tag">lab-notes</a>

<a href="./tags/rationals/" rel="tag">rationals</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/blogging-about-blogging/">blogging-about-blogging</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">A new system </h2>
<div class="outline-text-2" id="text-1">


<p>
  This is the obligatory post about how the new blogging system
  works.  Isn't that exciting?
</p>
<p>
  By my standards, this is a fairly simple system.  It is based on
  <a href="http://ikiwiki.info">ikiwiki</a>, which allows me to use <a href="http://orgmode">org-mode</a> to edit my posts and <a href="http://git-scm.com">git</a> as
  the version control system.  Since I already know those tools, I
  don't have to think about them and can just focus on writing.
</p>
<p>
  I'm less comfortable with making web pages look nice, but I took the
  CSS file from <a href="https://github.com/AntPortal/ikiwiked/raw/master/theme/gray-orange/local.css">the nice people at antportal.com</a> and added my own
  panoramic photo that I took while hiking.  I think the output is
  simple and looks pretty good.
</p>
<p>
  Finally, I am currently hosting the pages on <a href="http://github.com">github</a>.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">What I intend to write about </h2>
<div class="outline-text-2" id="text-2">


<p>
  The blog is currently called "Hiking and Coding".  So far I've only
  written about the latter, but I'm planning some posts about the
  former.  My current objective is to write once a day as a way to
  solidify what I'm thinking about for the day, so my posts will
  likely be about what I'm working on.  As such, expect them to be
  really boring.  I'm okay with that.  I'm also okay with you not
  subscribing.
</p>
<p>
  I will try to write about adventures I had while hiking on days that
  I'm not really working on anything.  Those posts will be tagged with
  the hiking tag.  They might be more exciting (though they might
  not).
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Thu Nov 10 19:13:21 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/blogging/" rel="tag">blogging</a>

<a href="./tags/emacs/" rel="tag">emacs</a>

<a href="./tags/git/" rel="tag">git</a>

<a href="./tags/hiking/" rel="tag">hiking</a>

<a href="./tags/ikiwiki/" rel="tag">ikiwiki</a>

<a href="./tags/org-mode/" rel="tag">org-mode</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/more-rationals/">more-rationals</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">More about rationals </h2>
<div class="outline-text-2" id="text-1">


<p>
  While attempting to implement <a href="http://chrismgray.github.com/posts/rationals-in-cljs/">support for rationals</a> yesterday, I
  stumbled on what is (or at least, seems to me to be) a bug in the
  Clojure compiler itself.  That is, one can not refer to the function
  <code>/</code> in namespaces other than <code>clojure.core</code>.  Now, this is probably
  the first time that anyone has wanted to do this, so it's not
  surprising that no one had seen the bug before.  But what was
  surprising to me was that I could fix it fairly easily.  I submitted
  my patch, and I should be a real-life contributor to Clojure pretty
  soon.  As a person who doesn't see himself as a compiler guy, that's
  pretty exciting.
</p>
<p>
  The next problem that I'm having is that redefining the basic
  arithmetic operations does not seem to work properly in
  Clojurescript.  The compiled javascript is trying (at least as far
  as I can tell) to redefine <code>cljs.core/+</code> rather than <code>rationals/+</code>,
  for example.  This is the problem that I am going to try to solve
  today.  
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Thu Nov 10 09:55:06 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/clojurescript/" rel="tag">clojurescript</a>

<a href="./tags/lab-notes/" rel="tag">lab-notes</a>

<a href="./tags/rationals/" rel="tag">rationals</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/rationals-followup/">rationals-followup</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">A small followup </h2>
<div class="outline-text-2" id="text-1">


<p>
  My previous post said that I would be using the macros defined in
  Clojurescript's <code>core.clj</code>.  It turns out that doesn't make a lot of
  sense.  I am using the functions defined in <code>core.cljs</code> instead.
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Wed Nov  9 15:03:16 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/clojurescript/" rel="tag">clojurescript</a>

<a href="./tags/lab-notes/" rel="tag">lab-notes</a>

<a href="./tags/rationals/" rel="tag">rationals</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/rationals-in-cljs/">rationals-in-cljs</a>

</span>
</div>

<div class="inlinecontent">
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Rationals in Clojurescript </h2>
<div class="outline-text-2" id="text-1">


<p>
Last night, I uploaded some code to compute the <a href="http://en.wikipedia.org/wiki/Voronoi_diagram">Voronoi Diagram</a> of a
set of points to <a href="https://github.com/chrismgray/voronoi-diagram/">github</a>.  This post is not directly about that code --
I'll write about that when it is completely working &ndash; but rather
about something that I noticed when I tried to convert the code to
<a href="https://github.com/clojure/clojurescript">Clojurescript</a>.
</p>
<p>
There are a few things that are known not to work in Clojurescript
that work in Clojure: I had to convert calls from <code>lazy-cat</code> to
<code>concat</code>, for example.  However, the one difference that really broke
things for me was the lack of support for rational arithmetic in
Clojurescript.
</p>
<p>
One major element of my algorithm is a test to determine whether a
given point is on a given line segment.  With integer coordinates for
the sites that determine the Voronoi Diagram and the bounding box,
everything about this test can be represented as a rational number.
Since Clojure gives you rational numbers by default, while
Clojurescript simply uses Javascript's arithmetic facilities, the test
works in Clojure but not in Clojurescript.
</p>
<p>
So what can be done about this?  Here are some options:
</p>
<ul>
<li id="sec-1-1">Use floats, but more smartly <br/>

<p>
     Probably the simplest option, here we would not test for <i>equality</i>,
     but for <i>almost equality</i>.  That is, if the distance between two
     points is a very small number (<i>e.g.</i> a millionth), and all of the
     input is integer, then the two points are probably the same.  This
     option is obviously not too satisfying from a theoretical
     standpoint, especially if the small number is hardcoded.  I am
     fairly sure that there has been research to determine what the exact
     value of the small number should be, but that would take the code
     out of the realm of simplicity.
</p>
</li>
</ul>
<ul>
<li id="sec-1-2">Implement rationals in Clojurescript <br/>

<p>
     I am not sure how possible this option is.  However, it is currently
     the most appealing to me.  Rational arithmetic is not so difficult
     to implement, especially in the limited use case that I need it for:
     I am pretty sure that I could get away with <code>/</code>, <code>*</code>, <code>+</code>, <code>-</code>, and
     the comparison operators.  These are currently implemented as
     <a href="https://github.com/clojure/clojurescript/blob/3c83c62d973b0153a9e28bea7beb73794fbf9065/src/clj/cljs/core.clj#L51">macros</a> in Clojurescript, which means that they take the
     Clojurescript code and change it Javascript code.  This allows
     the Clojurescript compiler to take the prefix syntax of
     Clojurescript and change it to the infix syntax of Javascript.
</p>
<p>
     If we were to redefine the operators to be functions, we might
     have a chance to run different code given different types of
     input.  The <code>defmulti</code> and <code>defmethod</code> macros seem perfect for
     this.  The major question is whether it is possible to shadow the
     names of the operators but use them nevertheless.  That is, will
     I be able to add <code>(:require-macros [clojure.core :as core])</code> to
     my namespace and then use, for example, <code>core/*</code>?
</p>
<p>
     The other downside, beyond the potential difficulties, is the
     fact that the generated Javascript will no longer be quite as
     pretty.  What used to be infix notation will be converted to
     function calls.  Additionally, there will be a fairly high
     penalty for doing arithmetic &ndash; three or four function calls per
     arithmetic operation (assuming the polymorphic solution I have in
     mind works) rather than the current single operation.
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Conclusion </h2>
<div class="outline-text-2" id="text-2">


<p>
  I am going to try to implement the rationals in Clojurescript
  first.  At the very least, I will learn a bit more about how
  multimethods work in Clojure. 
</p>


</div>
</div>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Wed Nov  9 10:13:06 2011</span>
</span>


<span class="tags">
Tags:

<a href="./tags/clojure/" rel="tag">clojure</a>

<a href="./tags/clojurescript/" rel="tag">clojurescript</a>

<a href="./tags/lab-notes/" rel="tag">lab-notes</a>

<a href="./tags/rationals/" rel="tag">rationals</a>

<a href="./tags/voronoi-diagram/" rel="tag">voronoi-diagram</a>

</span>








</div>

</div>


<p>This blog is powered by <a href="http://ikiwiki.info">ikiwiki</a>.</p>

</div>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hikingandcoding'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


<div id="footer" class="pagefooter">

<div id="pageinfo">




<div id="backlinks">
Links:

<a href="./comments/">comments</a>

<a href="./posts/">posts</a>


</div>






<div class="pagedate">
Last edited <span class="date">Thu Nov 10 13:12:04 2011</span>
<!-- Created <span class="date">Tue Nov  8 23:43:03 2011</span> -->
</div>

</div>


<!-- from Hiking and Coding -->
</div>

</div>

</body>
</html>
